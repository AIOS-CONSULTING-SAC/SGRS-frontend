<div class="p-4">
    <h3 class="text-lg font-semibold text-slate-900 mb-4">{{tituloComponente}}</h3>
    <form [formGroup]="form">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 mb-6">

            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Raz칩n social <small
                        class="p-error">*</small></label>
                <p-dropdown [options]="empresas" formControlName="empresa" optionLabel="nombreComercial"
                    optionValue="cliente" (onChange)="cambiarCliente()" placeholder="Empresa" class="w-full"
                    [autoDisplayFirst]="false" />
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">A침o <small
                        class="p-error">*</small></label>
                <p-dropdown [options]="anios" formControlName="anio" placeholder="A침o" optionLabel="descripcion1"
                    optionValue="entero01" class="w-full" />
            </div>
            <div>
                <label class="block text-sm font-medium text-slate-700 mb-1">Local <small
                        class="p-error">*</small></label>
                <p-multi-select [options]="localesFiltro" formControlName="local" optionValue="local"
                    optionLabel="nombre" class="w-full" placeholder="Seleccione local" />
            </div>

        </div>

        <div class="flex justify-end flex-wrap gap-3 mb-6">
            <p-button label="Limpiar" severity="secondary" [raised]="true" icon="pi pi-eraser" (click)="limpiar()"
                class="w-full sm:w-auto text-gray-700" [style]="{'min-width': '130px'}" />
            <button pButton label="Buscar" severity="info" [raised]="true" (click)="buscar()" icon="pi pi-search"
                styleClass=" text-gray-700" class="w-full sm:w-auto text-gray-700"
                [style]="{'min-width': '130px'}"></button>
            <!-- <p-button label="Editar" severity="contrast" [raised]="true" class="w-full sm:w-auto" icon="pi pi-plus"
                [style]="{'min-width': '130px'}" /> -->
            <p-button label="Editar" icon="pi pi-pencil"  *ngIf="residuosPorLocal.length>0 && !modoEdicion"
            severity="contrast" [raised]="true" class="w-full sm:w-auto" (click)="activarEdicion()"  />
            <p-button label="Guardar" icon="pi pi-save" (click)="desactivarEdicion()" severity="success"
                *ngIf="modoEdicion" />
        </div>
    </form>
    <p-table #table [value]="residuosPorLocal" class="tabla-locales"  [size]="'small'" dataKey="codLocal" [expandedRowKeys]="expandedRows"
        responsiveLayout="scroll">
        <!-- <ng-template pTemplate="caption">
            <div class="flex flex-wrap justify-content-end gap-2">
                <p-button label="Expandir todo" icon="pi pi-plus" text (onClick)="expandAll()" />
                <p-button label="Colapsar todo" icon="pi pi-minus" text (onClick)="collapseAll()" />
            </div>
        </ng-template>  -->
        <ng-template pTemplate="header">
            <tr>
                <th style="width: 3rem"></th>
                <th>Local</th>
                <th class="text-right">Total</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-local let-expanded="expanded">
            <tr>
                <td>
                    <p-button type="button" [size]="'small'" pRipple [pRowToggler]="local" [text]="true" [rounded]="true" [plain]="true"
                        [icon]="expanded ? 'pi pi-chevron-down' : 'pi pi-chevron-right'" />
                </td>
                <td>{{ local.descLocal }}</td>
                <td class="text-right">{{ local.total | number: '1.2-2' }}</td>
            </tr>
        </ng-template>

        <ng-template #expandedrow let-local>
            <tr>
                <td colspan="7">
                    <div class="p-3">
                        <p-table [value]="local.residuos" class="tabla-residuos" [size]="'small'" dataKey="codResiduo"
                            [scrollable]="true" responsiveLayout="scroll">
                            <ng-template pTemplate="header">
            <tr>
                <th pFrozenColumn>Descripci칩n</th>
                <th>Total</th>
                <th>Unidad</th>
                <th *ngFor="let mes of meses">{{ mes }}</th>
            </tr>
        </ng-template>
        <ng-template pTemplate="body" let-residuo let-rowIndex="rowIndex">
            <tr>
                <td pFrozenColumn>{{ residuo.descResiduo }}</td>
                <td>{{ residuo.total }}</td>
                <td>{{ residuo.descUnidad }}</td>
                <td *ngFor="let mes of meses; let i = index">
  <ng-container *ngIf="modoEdicion; else lectura">
    <input
      #inputMes
      pInputText
      [attr.data-local]="local.codLocal"
  [attr.data-row]="rowIndex"
  [attr.data-col]="i"
      (keydown)="navegarConFlechas($event, local.codLocal)"
      (input)="validar3Decimales($event, residuo, i + 1)"
      [(ngModel)]="residuo['mes' + (i + 1).toString().padStart(2, '0')]"
      class="p-inputtext p-inputtext-sm"
      style="width: 70px; text-align: center"
    />
  </ng-container>
  <ng-template #lectura>
    {{ residuo['mes' + (i + 1).toString().padStart(2, '0')] }}
  </ng-template>
</td>
            </tr>
        </ng-template>
    </p-table>
</div>
</td>
</tr>

</ng-template>
</p-table>



</div>